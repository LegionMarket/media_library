!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";function i(e){var i=/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,t=e.match(i);return t&&11==t[2].length?t[2]:void 0}function t(i,a){this.$element=e(i),this.options=e.extend({},t.DEFAULTS,e.isPlainObject(a)&&a),this.init()}var a="qor.medialibrary.action",n="enable."+a,o="disable."+a,r="keyup."+a,d="switched.qor.tabbar.radio",s='[data-toggle="qor.tab.radio"]',l='[name="QorResource.SelectedType"]',c='[data-tab-source="video_link"]',f=".qor-video__link",u=".qor-medialibrary__video-link",h=".qor-medialibrary__video",m=".qor-medialibrary__desc",v=".qor-file__options",b='input[name="QorResource.MediaOption"]';return t.prototype={constructor:t,init:function(){this.bind(),this.initMedia()},bind:function(){e(document).on(d,s,this.resetMediaData.bind(this)).on(r,f,this.setVideo.bind(this)).on(r,m,this.setImageDesc.bind(this))},unbind:function(){e(document).off(d,s,this.resetMediaData.bind(this)).off(r,f,this.setVideo.bind(this)).off(r,m,this.setImageDesc.bind(this))},setMediaData:function(e,i){var t=e.find(v),a=e.find(b);t.val(JSON.stringify(i)),a.val(JSON.stringify(i))},setImageDesc:function(i){var t,a,n=e(i.target),o=n.closest("form");t=o.find(v),a=JSON.parse(t.val()),a.Description=n.val(),this.setMediaData(o,a)},initMedia:function(){e(h).each(function(){var i=e(this),t=i.data().videolink,a=t&&t.match(/\.mp4$|\.m4p$|\.m4v$|\.m4v$|\.mov$|\.mpeg$|\.webm$|\.avi$|\.ogg$|\.ogv$/);a&&(i.closest("tr").data("isUploadedVideo",!0),i.parent().addClass("qor-table--video qor-table--video-internal").html('<video width=100% height=100% controls><source src="'+t+'"></video>'))}),e(u).each(function(){var t=e(this),a=t.data("videolink"),n=i(a);n&&(t.closest("tr").data("isExternalVideo",!0),t.parent().addClass("qor-table--video qor-table--video-external").html('<iframe width="100%" height="100%" src="//www.youtube.com/embed/'+n+'?rel=0" frameborder="0" allowfullscreen></iframe>'))})},setVideo:function(t){var a=e(t.target),n=a.closest("[data-tab-source]"),o=a.closest("form"),r=o.find(v),d=JSON.parse(r.val()),s=a.val(),l=n.find("iframe"),c=i(s);d.SelectedType="video_link",d.Video=s,this.setMediaData(o,d),c&&(l.length&&l.remove(),n.append('<iframe width="100%" height="400" src="//www.youtube.com/embed/'+i(s)+'?rel=0" frameborder="0" allowfullscreen></iframe>'))},resetMediaData:function(i,t,a){var n=e(t),o=n.closest("form"),r=n.find(v),d=n.find(c).find(".qor-fieldset__alert"),s=JSON.parse(r.val());s.SelectedType=a,"video_link"==a&&(s.Video=n.find(f).val(),d.length&&d.remove()),s.Description=e('[data-tab-source="'+a+'"]').find(m).val(),e(l).val(a),this.setMediaData(o,s)},destroy:function(){this.unbind()}},t.DEFAULTS={},e.fn.qorSliderAfterShow=e.fn.qorSliderAfterShow||{},e.fn.qorSliderAfterShow.renderMediaVideo=function(){var t=e(c),a=e(m),n=t.length&&t.data().videourl;a.length&&a.val(a.data().imageInfo.Description),t.length&&n&&t.append('<iframe width="100%" height="400" src="//www.youtube.com/embed/'+i(n)+'?rel=0&fs=0&modestbranding=1&disablekb=1" frameborder="0" allowfullscreen></iframe>')},t.plugin=function(i){return this.each(function(){var n,o=e(this),r=o.data(a);if(!r){if(/destroy/.test(i))return;o.data(a,r=new t(this,i))}"string"==typeof i&&e.isFunction(n=r[i])&&n.apply(r)})},e(function(){var i=".qor-table--medialibrary";e(document).on(o,function(a){t.plugin.call(e(i,a.target),"destroy")}).on(n,function(a){t.plugin.call(e(i,a.target))}).triggerHandler(n)}),t});