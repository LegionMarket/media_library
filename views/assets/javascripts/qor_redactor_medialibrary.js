$.Redactor.prototype.medialibrary=function(){return{reUrlYoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,reUrlVimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,reVideo:/\.mp4$|\.m4p$|\.m4v$|\.m4v$|\.mov$|\.mpeg$|\.webm$|\.avi$|\.ogg$|\.ogv$/,init:function(){var e=this.button.add("medialibrary","MediaLibrary");this.button.addCallback(e,this.medialibrary.addMedialibrary),this.button.setIcon(e,'<i class="material-icons">photo_library</i>'),$(document).on("reload.qor.bottomsheets",".qor-bottomsheets__mediabox",this.medialibrary.initItem)},addMedialibrary:function(){var e,i=this.$element,t={selectModal:"mediabox",maxItem:"1"},a=i.data().redactorSettings.medialibraryUrl;this.medialibrary.BottomSheets=e=$("body").data("qor.bottomsheets"),t.url=a,e.open(t,this.medialibrary.handleMediaLibrary)},handleMediaLibrary:function(){var e=$(".qor-bottomsheets"),i={onSelect:this.medialibrary.selectResults,onSubmit:this.medialibrary.submitResults};e.qorSelectCore(i).addClass("qor-bottomsheets__mediabox"),this.medialibrary.initItem()},initItem:function(){var e,i,t=$(".qor-bottomsheets").find("tbody tr");t.each(function(){e=$(this),i=e.find(".qor-table--ml-slideout p img").first(),e.find(".qor-table__actions").remove(),i.length&&(e.find(".qor-table--medialibrary-item").css("background-image","url("+i.prop("src")+")"),i.parent().hide())})},selectResults:function(e){this.medialibrary.handleResults(e)},submitResults:function(e){this.medialibrary.handleResults(e,!0)},handleResults:function(e,i){i?"video_link"==e.SelectedType||JSON.parse(e.MediaOption).URL.match(this.medialibrary.reVideo)?this.medialibrary.insertVideoCode(e,!0):this.medialibrary.insertImages(e,!0):e.isExternalVideo||e.isUploadedVideo?this.medialibrary.insertVideoCode(e):this.medialibrary.insertImages(e),this.medialibrary.BottomSheets.hide()},insertVideoCode:function(e,i){this.opts.mediaContainerClass="undefined"==typeof this.opts.mediaContainerClass?"qor-video-container":this.opts.mediaContainerClass;var t,a,r,o,s,d=this.opts.mediaContainerClass,l="video_link"==e.SelectedType,n='<iframe class="'+d+'" aria-label="'+e.MediaOption.Description+'" style="width: 100%; height: 380px;" src="',m='" frameborder="0" allowfullscreen></iframe>';i?(o=JSON.parse(e.MediaOption),l?(r=o.Video,r.match(this.medialibrary.reUrlYoutube)&&(t=r.replace(this.medialibrary.reUrlYoutube,n+"//www.youtube.com/embed/$1"+m))):o.URL.match(this.medialibrary.reVideo)&&(t='<video width="100%" height="380px" controls class="'+d+'" aria-label="'+e.MediaOption.Description+'"><source src="'+o.URL+'"></video>')):(t=e.File||e.$clickElement.find(".qor-table--video").html(),a=$(t).addClass(d).attr("aria-label",e.MediaOption.Description),t=a[0].outerHTML),s=this.selection.$currentTag,s&&s.after(t),this.code.sync()},insertImages:function(e){var i,t,a=$("<img>"),r=$("<"+this.opts.imageTag+">"),o=e.MediaOption;i=o.URL.replace(/image\..+\./,"image."),a.attr({src:i,alt:o.Description}),r.append(a),t=this.selection.$currentTag,t&&t.after(r),this.image.setEditable(a),this.code.sync()}}};