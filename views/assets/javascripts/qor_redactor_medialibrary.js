$.Redactor.prototype.medialibrary=function(){return{init:function(){var e=this.button.add("medialibrary","MediaLibrary");this.button.addCallback(e,this.medialibrary.addMedialibrary),this.button.setIcon(e,'<i class="material-icons">photo_library</i>'),$(document).on("reload.qor.bottomsheets",".qor-bottomsheets__mediabox",this.medialibrary.initItem)},addMedialibrary:function(){var e,i=this.$element,t={selectModal:"mediabox",maxItem:"1"},a=i.data().redactorSettings.medialibraryUrl;this.medialibrary.BottomSheets=e=$("body").data("qor.bottomsheets"),t.url=a,e.open(t,this.medialibrary.handleMediaLibrary)},handleMediaLibrary:function(){var e=$(".qor-bottomsheets"),i={onSelect:this.medialibrary.selectResults,onSubmit:this.medialibrary.submitResults};this.medialibrary.$bottomsheets=e,e.qorSelectCore(i).addClass("qor-bottomsheets__mediabox"),this.medialibrary.initItem()},initItem:function(){var e,i,t=$(".qor-bottomsheets").find("tbody tr");t.each(function(){e=$(this),i=e.find(".qor-table--ml-slideout p img").first(),e.find(".qor-table__actions").remove(),i.length&&(e.find(".qor-table--medialibrary-item").css("background-image","url("+i.prop("src")+")"),i.parent().remove())})},selectResults:function(e){this.medialibrary.handleResults(e)},submitResults:function(e){this.medialibrary.handleResults(e,!0)},handleResults:function(e,i){i&&(e.MediaOption=JSON.parse(e.MediaOption));var t=/\.mp4$|\.m4p$|\.m4v$|\.m4v$|\.mov$|\.mpeg$|\.webm$|\.avi$|\.ogg$|\.ogv$/,a=e.MediaOption;"video_link"==e.SelectedType||a.Video||a.URL.match(t)?this.medialibrary.insertVideo(e):this.medialibrary.insertImage(e),this.medialibrary.$bottomsheets.qorSelectCore("destroy"),this.medialibrary.BottomSheets.hide()},insertVideo:function(e){this.opts.mediaContainerClass="undefined"==typeof this.opts.mediaContainerClass?"qor-video-container":this.opts.mediaContainerClass;var i,t,a,o,r,s,d={},n=this.opts.mediaContainerClass,l=this.opts.regexps.linkyoutube,m=this.opts.regexps.linkvimeo,c=/\.mp4$|\.m4p$|\.m4v$|\.m4v$|\.mov$|\.mpeg$|\.webm$|\.avi$|\.ogg$|\.ogv$/,h=(Math.random()+1).toString(36).substring(7),b="qor-video-"+h,p=e.MediaOption,u=p.Description;o='<figure class="'+n+'"><iframe title="'+u+'" width="100%" height="380px" src="',r='" frameborder="0" allowfullscreen></iframe><figcaption>'+u+"</figcaption></figure>","video_link"==e.SelectedType?(t=p.Video,t.match(l)&&(s="youtube",i=t.replace(l,o+"//www.youtube.com/embed/$1"+r)),t.match(m)&&(s="vimeo",i=t.replace(m,o+"//player.vimeo.com/video/$2"+r))):p.URL.match(c)&&(s="uploadedVideo",i='<figure class="'+n+'"><div role="application"><video width="100%" title="'+u+'" aria-label="'+u+'" height="380px" controls="controls" aria-describedby="'+b+'" tabindex="0"><source src="'+p.URL+'"></video></div><figcaption id="'+b+'">'+u+"</figcaption></figure>"),i&&(a=this.selection.$currentTag,a&&$(i).addClass(b).insertAfter(a),this.code.sync(),d.type=s,d.videoLink=t||p.URL,d.videoIdentification=b,d.description=u,d.$editor=this.$editor,d.$element=this.$element,this.$element.trigger("insertedVideo.redactor",[d]))},insertImage:function(e){var i,t,a=$("<img>"),o=$("<"+this.opts.imageTag+">"),r=e.MediaOption;i=r.URL.replace(/image\..+\./,"image."),a.attr({src:i,alt:r.Description}),o.append(a),t=this.selection.$currentTag,t&&t.after(o),this.image.setEditable(a),this.code.sync()}}};