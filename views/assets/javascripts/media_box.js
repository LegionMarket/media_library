!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";function t(i,n){this.$element=e(i),this.options=e.extend({},t.DEFAULTS,e.isPlainObject(n)&&n),this.init()}var i=e("body"),n=e(document),a=window.Mustache,o="qor.selectone",s="click."+o,r="enable."+o,l="disable."+o,d=".qor-selected-many__remove",c="qor-selected-many__deleted",m=".qor-select__select-icon",h=".qor-selectmany__hint",u=".qor-field__mediabox",f=".qor-field__mediabox-list",p=".qor-field__mediabox-data",y=".qor-bottomsheets",_="is_selected";return t.prototype={constructor:t,init:function(){this.bind()},bind:function(){n.on(s,"[data-mediabox-url]",this.openBottomSheets.bind(this)),this.$element.on(s,d,this.clearSelect.bind(this))},clearSelect:function(t){var i=e(t.target),n=i.closest(u);return i.closest("[data-primary-key]").addClass(c),this.updateSelectInputData(n),!1},undoDelete:function(t){var i=e(t.target),n=i.closest(u);return i.closest("[data-primary-key]").removeClass(c),this.updateSelectInputData(n),!1},openBottomSheets:function(t){var n,a=e(t.target).closest("[data-mediabox-url]"),o=a.data();this.BottomSheets=i.data("qor.bottomsheets"),this.bottomsheetsData=o,this.$parent=n=a.closest(u),this.$selectFeild=n.find(f),this.$mediaLrbraryData=n.find(p),this.SELECT_MANY_SELECTED_ICON=e('[name="select-many-selected-icon"]').html(),this.SELECT_MANY_UNSELECTED_ICON=e('[name="select-many-unselected-icon"]').html(),this.SELECT_MANY_HINT=e('[name="select-many-hint"]').html(),this.SELECT_MEDIABOX_TEMPLATE=e('[name="media-box-template"]').html(),o.url=o.mediaboxUrl,this.BottomSheets.open(o,this.handleSelectMany.bind(this))},renderSelectMany:function(e){return a.render(this.SELECT_MEDIABOX_TEMPLATE,e)},renderHint:function(e){return a.render(this.SELECT_MANY_HINT,e)},getSelectedItemData:function(){var t=e(y).find(".is_selected");return{selectedNum:t.size()}},updateHint:function(t){var i;e.extend(t,this.bottomsheetsData),i=this.renderHint(t),e(h).remove(),e(y).find(".qor-bottomsheets__body").prepend(i)},updateSelectInputData:function(e){var t=this.$mediaLrbraryData,i=t.val()?JSON.parse(t.val()):[],e={ID:e.primaryKey,Url:e.File.Url};console.log(i),i.push(e),t.val(JSON.stringify(i)),console.log(i),console.log(t.val())},changeIcon:function(e,t){e.find(m).remove(),t&&e.find(".qor-table--medialibrary-item").prepend(this.SELECT_MANY_SELECTED_ICON)},removeItem:function(e){var t=e.primaryKey;this.$selectFeild.find('[data-primary-key="'+t+'"]').remove(),this.changeIcon(e.$clickElement)},addItem:function(i,n){var o,s=e(this.renderSelectMany(i));this.$selectFeild.find('[data-primary-key="'+i.primaryKey+'"]');return s.appendTo(this.$selectFeild.find("ul")),n?(o=e(a.render(t.SELECT_MANY_OPTION_TEMPLATE,i)),o.prop("selected",!0),void this.BottomSheets.hide()):void this.changeIcon(i.$clickElement,!0)},handleSelectMany:function(){var t=e(y),i={formatOnSelect:this.formatSelectResults.bind(this),formatOnSubmit:this.formatSubmitResults.bind(this)};t.qorSelectCore(i),this.$selectFeild.append('<input type="file" class="qor-file__input visuallyhidden" />')},formatSelectResults:function(e){this.formatResults(e)},formatSubmitResults:function(e){this.formatResults(e,!0)},formatResults:function(t,i){var n="/admin/media_libraries/"+t.primaryKey,a=t.$clickElement,o=this,s=t;t.File?o.handleFormat(s,i):e.getJSON(n,function(t){t.File=JSON.parse(t.File),a.data(t),e.extend(s,t),o.handleFormat(s,i)})},handleFormat:function(e,t){var i,n=e.$clickElement;return t?void this.addItem(e,!0):(n.toggleClass(_),i=n.hasClass(_),i?this.addItem(e):this.removeItem(e),this.updateHint(this.getSelectedItemData()),void this.updateSelectInputData(e))}},t.SELECT_MANY_OPTION_TEMPLATE='<option value="[[ primaryKey ]]" >[[ Name ]]</option>',t.plugin=function(i){return this.each(function(){var n,a=e(this),s=a.data(o);if(!s){if(/destroy/.test(i))return;a.data(o,s=new t(this,i))}"string"==typeof i&&e.isFunction(n=s[i])&&n.apply(s)})},e(function(){var i='[data-toggle="qor.mediabox"]';e(document).on(l,function(n){t.plugin.call(e(i,n.target),"destroy")}).on(r,function(n){t.plugin.call(e(i,n.target))}).triggerHandler(r)}),t});
//# sourceMappingURL=media_box.js.map
