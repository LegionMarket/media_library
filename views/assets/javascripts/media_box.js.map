{"version":3,"sources":["media_box.js"],"names":["factory","define","amd","exports","require","jQuery","$","QorMediaBox","element","options","this","$element","extend","DEFAULTS","isPlainObject","init","$body","$document","document","Mustache","window","NAMESPACE","EVENT_CLICK","EVENT_ENABLE","EVENT_DISABLE","CLASS_CLEAR_SELECT","CLASS_DELETED_ITEM","CLASS_SELECT_ICON","CLASS_SELECT_HINT","CLASS_PARENT","CLASS_BOTTOMSHEETS","CLASS_SELECTED","prototype","constructor","bind","on","openBottomSheets","clearSelect","e","$target","target","$selectFeild","closest","addClass","updateSelectInputData","undoDelete","removeClass","$ele","data","BottomSheets","bottomsheetsData","$selector","selectId","SELECT_MANY_SELECTED_ICON","html","SELECT_MANY_UNSELECTED_ICON","SELECT_MANY_HINT","SELECT_MEDIABOX_TEMPLATE","url","mediaboxUrl","open","handleSelectMany","renderSelectMany","render","renderHint","getSelectedItemData","selecedItems","find","selectedNum","size","updateHint","template","remove","prepend","$selectList","$selectedItems","not","prop","each","filter","primaryKey","changeIcon","isAdd","removeItem","$clickElement","addItem","isNewData","$option","$template","appendTo","val","JSON","stringify","File","trigger","SELECT_MANY_OPTION_TEMPLATE","append","hide","$bottomsheets","formatOnSelect","formatSelectResults","formatOnSubmit","formatSubmitResults","qorSelectCore","formatResults","_this","formatData","handleFormat","getJSON","parse","isSelected","toggleClass","hasClass","plugin","fn","$this","test","isFunction","apply","selector","call","triggerHandler"],"mappings":"CAAA,SAAAA,GACA,kBAAAC,SAAAA,OAAAC,IAEAD,QAAA,UAAAD,GAGAA,EAFA,gBAAAG,SAEAC,QAAA,UAGAC,SAEA,SAAAC,GAEA,YAkBA,SAAAC,GAAAC,EAAAC,GACAC,KAAAC,SAAAL,EAAAE,GACAE,KAAAD,QAAAH,EAAAM,UAAAL,EAAAM,SAAAP,EAAAQ,cAAAL,IAAAA,GACAC,KAAAK,OAnBA,GAAAC,GAAAV,EAAA,QACAW,EAAAX,EAAAY,UACAC,EAAAC,OAAAD,SACAE,EAAA,gBACAC,EAAA,SAAAD,EACAE,EAAA,UAAAF,EACAG,EAAA,WAAAH,EACAI,EAAA,6BACAC,EAAA,6BACAC,EAAA,2BACAC,EAAA,wBACAC,EAAA,uBACAC,EAAA,oBACAC,EAAA,aA6OA,OApOAxB,GAAAyB,WACAC,YAAA1B,EAEAQ,KAAA,WACAL,KAAAwB,QAGAA,KAAA,WACAjB,EAAAkB,GAAAb,EAAA,sBAAAZ,KAAA0B,iBAAAF,KAAAxB,OACAA,KAAAC,SAAAwB,GAAAb,EAAAG,EAAAf,KAAA2B,YAAAH,KAAAxB,QAGA2B,YAAA,SAAAC,GACA,GAAAC,GAAAjC,EAAAgC,EAAAE,QACAC,EAAAF,EAAAG,QAAAb,EAKA,OAHAU,GAAAG,QAAA,sBAAAC,SAAAjB,GACAhB,KAAAkC,sBAAAH,IAEA,GAGAI,WAAA,SAAAP,GACA,GAAAC,GAAAjC,EAAAgC,EAAAE,QACAC,EAAAF,EAAAG,QAAAb,EAKA,OAHAU,GAAAG,QAAA,sBAAAI,YAAApB,GACAhB,KAAAkC,sBAAAH,IAEA,GAGAL,iBAAA,SAAAE,GACA,GAAAS,GAAAzC,EAAAgC,EAAAE,QAAAE,QAAA,uBACAM,EAAAD,EAAAC,MAEAtC,MAAAuC,aAAAjC,EAAAgC,KAAA,oBACAtC,KAAAwC,iBAAAF,EAEAtC,KAAAyC,UAAA7C,EAAA0C,EAAAI,UACA1C,KAAA+B,aAAAM,EAAAL,QAAAb,GAGAnB,KAAA2C,0BAAA/C,EAAA,sCAAAgD,OACA5C,KAAA6C,4BAAAjD,EAAA,wCAAAgD,OACA5C,KAAA8C,iBAAAlD,EAAA,6BAAAgD,OACA5C,KAAA+C,yBAAAnD,EAAA,+BAAAgD,OAEAN,EAAAU,IAAAV,EAAAW,YAEAjD,KAAAuC,aAAAW,KAAAZ,EAAAtC,KAAAmD,iBAAA3B,KAAAxB,QAIAoD,iBAAA,SAAAd,GACA,MAAA7B,GAAA4C,OAAArD,KAAA+C,yBAAAT,IAGAgB,WAAA,SAAAhB,GACA,MAAA7B,GAAA4C,OAAArD,KAAA8C,iBAAAR,IAGAiB,oBAAA,WACA,GAAAC,GAAA5D,EAAAwB,GAAAqC,KAAA,eACA,QACAC,YAAAF,EAAAG,SAIAC,WAAA,SAAAtB,GACA,GAAAuB,EAEAjE,GAAAM,OAAAoC,EAAAtC,KAAAwC,kBACAqB,EAAA7D,KAAAsD,WAAAhB,GAEA1C,EAAAsB,GAAA4C,SACAlE,EAAAwB,GAAAqC,KAAA,2BAAAM,QAAAF,IAGA3B,sBAAA,SAAAH,GACA,GAAAiC,GAAAjC,EAAAA,EAAA/B,KAAA+B,aACAkC,EAAAD,EAAAP,KAAA,sBAAAS,IAAA,IAAAlD,GACAyB,EAAAV,EAAAA,EAAA0B,KAAA,UAAAzD,KAAAyC,UACA1C,EAAA0C,EAAAgB,KAAA,SAEA1D,GAAAoE,KAAA,YAAA,GAEAF,EAAAG,KAAA,WACArE,EAAAsE,OAAA,WAAAzE,EAAAI,MAAAsC,OAAAgC,WAAA,MAAAH,KAAA,YAAA,MAIAI,WAAA,SAAAlC,EAAAmC,GACAnC,EAAAoB,KAAAxC,GAAA6C,SAEAU,GACAnC,EAAAoB,KAAA,iCAAAM,QAAA/D,KAAA2C,4BAKA8B,WAAA,SAAAnC,GACA,GAAAgC,GAAAhC,EAAAgC,UAEAtE,MAAA+B,aAAA0B,KAAA,sBAAAa,EAAA,MAAAR,SACA9D,KAAAuE,WAAAjC,EAAAoC,gBAGAC,QAAA,SAAArC,EAAAsC,GACA,GACAC,GADAC,EAAAlF,EAAAI,KAAAoD,iBAAAd,GAEAtC,MAAA+B,aAAA0B,KAAA,sBAAAnB,EAAAgC,WAAA,KASA,OANAQ,GAAAC,SAAA/E,KAAA+B,aAAA0B,KAAA,OAEAzD,KAAAC,SAAAwD,KAAA,sBAAAuB,IAAAC,KAAAC,UAAA5C,EAAA6C,OAEAL,EAAAM,QAAA,UAEAR,GACAC,EAAAjF,EAAAa,EAAA4C,OAAAxD,EAAAwF,4BAAA/C,IACAtC,KAAAyC,UAAA6C,OAAAT,GACAA,EAAAV,KAAA,YAAA,OACAnE,MAAAuC,aAAAgD,YAIAvF,MAAAuE,WAAAjC,EAAAoC,eAAA,IAGAvB,iBAAA,WACA,GAAAqC,GAAA5F,EAAAwB,GACArB,GACA0F,eAAAzF,KAAA0F,oBAAAlE,KAAAxB,MACA2F,eAAA3F,KAAA4F,oBAAApE,KAAAxB,MAGAwF,GAAAK,cAAA9F,IAIA2F,oBAAA,SAAApD,GACAtC,KAAA8F,cAAAxD,IAGAsD,oBAAA,SAAAtD,GACAtC,KAAA8F,cAAAxD,GAAA,IAGAwD,cAAA,SAAAxD,EAAAsC,GACA,GAAA5B,GAAA,0BAAAV,EAAAgC,WACArE,EAAAqC,EAAAoC,cACAqB,EAAA/F,KACAgG,EAAA1D,CAEAA,GAAA6C,KAQAY,EAAAE,aAAAD,EAAApB,GAPAhF,EAAAsG,QAAAlD,EAAA,SAAAV,GACAA,EAAA6C,KAAAF,KAAAkB,MAAA7D,EAAA6C,MACAlF,EAAAqC,KAAAA,GACA1C,EAAAM,OAAA8F,EAAA1D,GACAyD,EAAAE,aAAAD,EAAApB,MAQAqB,aAAA,SAAA3D,EAAAsC,GACA,GACAwB,GADAnG,EAAAqC,EAAAoC,aAGA,OAAAE,OACA5E,MAAA2E,QAAArC,GAAA,IAIArC,EAAAoG,YAAAhF,GACA+E,EAAAnG,EAAAqG,SAAAjF,GAEA+E,EACApG,KAAA2E,QAAArC,GAEAtC,KAAAyE,WAAAnC,GAGAtC,KAAA4D,WAAA5D,KAAAuD,2BACAvD,MAAAkC,2BAMArC,EAAAwF,4BAAA,wDAEAxF,EAAA0G,OAAA,SAAAxG,GACA,MAAAC,MAAAoE,KAAA,WACA,GAEAoC,GAFAC,EAAA7G,EAAAI,MACAsC,EAAAmE,EAAAnE,KAAA3B,EAGA,KAAA2B,EAAA,CACA,GAAA,UAAAoE,KAAA3G,GACA,MAGA0G,GAAAnE,KAAA3B,EAAA2B,EAAA,GAAAzC,GAAAG,KAAAD,IAGA,gBAAAA,IAAAH,EAAA+G,WAAAH,EAAAlE,EAAAvC,KACAyG,EAAAI,MAAAtE,MAKA1C,EAAA,WACA,GAAAiH,GAAA,8BACAjH,GAAAY,UACAiB,GAAAX,EAAA,SAAAc,GACA/B,EAAA0G,OAAAO,KAAAlH,EAAAiH,EAAAjF,EAAAE,QAAA,aAEAL,GAAAZ,EAAA,SAAAe,GACA/B,EAAA0G,OAAAO,KAAAlH,EAAAiH,EAAAjF,EAAAE,WAEAiF,eAAAlG,KAGAhB","file":"media_box.js","sourcesContent":["(function (factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as anonymous module.\n    define(['jquery'], factory);\n  } else if (typeof exports === 'object') {\n    // Node / CommonJS\n    factory(require('jquery'));\n  } else {\n    // Browser globals.\n    factory(jQuery);\n  }\n})(function ($) {\n\n  'use strict';\n\n  var $body = $('body');\n  var $document = $(document);\n  var Mustache = window.Mustache;\n  var NAMESPACE = 'qor.selectone';\n  var EVENT_CLICK = 'click.' + NAMESPACE;\n  var EVENT_ENABLE = 'enable.' + NAMESPACE;\n  var EVENT_DISABLE = 'disable.' + NAMESPACE;\n  var CLASS_CLEAR_SELECT = '.qor-selected-many__remove';\n  var CLASS_DELETED_ITEM = 'qor-selected-many__deleted';\n  var CLASS_SELECT_ICON = '.qor-select__select-icon';\n  var CLASS_SELECT_HINT = '.qor-selectmany__hint';\n  var CLASS_PARENT = '.qor-field__mediabox';\n  var CLASS_BOTTOMSHEETS = '.qor-bottomsheets';\n  var CLASS_SELECTED = 'is_selected';\n\n\n  function QorMediaBox(element, options) {\n    this.$element = $(element);\n    this.options = $.extend({}, QorMediaBox.DEFAULTS, $.isPlainObject(options) && options);\n    this.init();\n  }\n\n  QorMediaBox.prototype = {\n    constructor: QorMediaBox,\n\n    init: function () {\n      this.bind();\n    },\n\n    bind: function () {\n      $document.on(EVENT_CLICK, '[data-mediabox-url]', this.openBottomSheets.bind(this));\n      this.$element.on(EVENT_CLICK, CLASS_CLEAR_SELECT, this.clearSelect.bind(this));\n    },\n\n    clearSelect: function (e) {\n      var $target = $(e.target),\n          $selectFeild = $target.closest(CLASS_PARENT);\n\n      $target.closest('[data-primary-key]').addClass(CLASS_DELETED_ITEM);\n      this.updateSelectInputData($selectFeild);\n\n      return false;\n    },\n\n    undoDelete: function (e) {\n      var $target = $(e.target),\n          $selectFeild = $target.closest(CLASS_PARENT);\n\n      $target.closest('[data-primary-key]').removeClass(CLASS_DELETED_ITEM);\n      this.updateSelectInputData($selectFeild);\n\n      return false;\n    },\n\n    openBottomSheets: function (e) {\n      var $ele = $(e.target).closest('[data-mediabox-url]'),\n          data = $ele.data();\n\n      this.BottomSheets = $body.data('qor.bottomsheets');\n      this.bottomsheetsData = data;\n\n      this.$selector = $(data.selectId);\n      this.$selectFeild = $ele.closest(CLASS_PARENT);\n\n      // select many templates\n      this.SELECT_MANY_SELECTED_ICON = $('[name=\"select-many-selected-icon\"]').html();\n      this.SELECT_MANY_UNSELECTED_ICON = $('[name=\"select-many-unselected-icon\"]').html();\n      this.SELECT_MANY_HINT = $('[name=\"select-many-hint\"]').html();\n      this.SELECT_MEDIABOX_TEMPLATE = $('[name=\"media-box-template\"]').html();\n\n      data.url = data.mediaboxUrl;\n\n      this.BottomSheets.open(data, this.handleSelectMany.bind(this));\n\n    },\n\n    renderSelectMany: function (data) {\n      return Mustache.render(this.SELECT_MEDIABOX_TEMPLATE, data);\n    },\n\n    renderHint: function (data) {\n      return Mustache.render(this.SELECT_MANY_HINT, data);\n    },\n\n    getSelectedItemData: function() {\n      var selecedItems = $(CLASS_BOTTOMSHEETS).find('.is_selected');\n      return {\n        selectedNum: selecedItems.size()\n      };\n    },\n\n    updateHint: function (data) {\n      var template;\n\n      $.extend(data, this.bottomsheetsData);\n      template = this.renderHint(data);\n\n      $(CLASS_SELECT_HINT).remove();\n      $(CLASS_BOTTOMSHEETS).find('.qor-bottomsheets__body').prepend(template);\n    },\n\n    updateSelectInputData: function ($selectFeild) {\n      var $selectList = $selectFeild ?  $selectFeild : this.$selectFeild,\n          $selectedItems = $selectList.find('[data-primary-key]').not('.' + CLASS_DELETED_ITEM),\n          $selector = $selectFeild ? $selectFeild.find('select') : this.$selector,\n          options = $selector.find('option');\n\n      options.prop('selected', false);\n\n      $selectedItems.each(function () {\n        options.filter('[value=\"' + $(this).data().primaryKey + '\"]').prop('selected', true);\n      });\n    },\n\n    changeIcon: function ($ele, isAdd) {\n      $ele.find(CLASS_SELECT_ICON).remove();\n\n      if (isAdd) {\n        $ele.find('.qor-table--medialibrary-item').prepend(this.SELECT_MANY_SELECTED_ICON);\n      }\n      \n    },\n\n    removeItem: function (data) {\n      var primaryKey = data.primaryKey;\n\n      this.$selectFeild.find('[data-primary-key=\"' + primaryKey + '\"]').remove();\n      this.changeIcon(data.$clickElement);\n    },\n\n    addItem: function (data, isNewData) {\n      var $template = $(this.renderSelectMany(data)),\n          $option,\n          $list = this.$selectFeild.find('[data-primary-key=\"' + data.primaryKey + '\"]');\n\n\n      $template.appendTo(this.$selectFeild.find('ul'));\n\n      this.$element.find('.qor-file__options').val(JSON.stringify(data.File));\n\n      $template.trigger('enable');\n\n      if (isNewData) {\n        $option = $(Mustache.render(QorMediaBox.SELECT_MANY_OPTION_TEMPLATE, data));\n        this.$selector.append($option);\n        $option.prop('selected', true);\n        this.BottomSheets.hide();\n        return;\n      }\n\n      this.changeIcon(data.$clickElement, true);\n    },\n\n    handleSelectMany: function () {\n      var $bottomsheets = $(CLASS_BOTTOMSHEETS),\n          options = {\n            formatOnSelect: this.formatSelectResults.bind(this),  // render selected item after click item lists\n            formatOnSubmit: this.formatSubmitResults.bind(this)   // render new items after new item form submitted\n          };\n\n      $bottomsheets.qorSelectCore(options);\n      // this.$selectFeild.append('');\n    },\n\n    formatSelectResults: function (data) {\n      this.formatResults(data);\n    },\n\n    formatSubmitResults: function (data) {\n      this.formatResults(data, true);\n    },\n\n    formatResults: function (data, isNewData) {\n      var url = '/admin/media_libraries/' + data.primaryKey,\n          $element = data.$clickElement,\n          _this = this,\n          formatData = data;\n\n      if (!data.File) {\n        $.getJSON(url,function(data){\n          data.File = JSON.parse(data.File);\n          $element.data(data);\n          $.extend(formatData, data);\n          _this.handleFormat(formatData, isNewData);\n        });\n      } else {\n        _this.handleFormat(formatData, isNewData);\n      }\n\n    },\n\n    handleFormat: function (data, isNewData) {\n      var $element = data.$clickElement,\n          isSelected;\n\n      if (isNewData) {\n        this.addItem(data, true);\n        return;\n      }\n\n      $element.toggleClass(CLASS_SELECTED);\n      isSelected = $element.hasClass(CLASS_SELECTED);\n\n      if (isSelected) {\n        this.addItem(data);\n      } else {\n        this.removeItem(data);\n      }\n\n      this.updateHint(this.getSelectedItemData());\n      this.updateSelectInputData();\n\n    }\n\n  };\n\n  QorMediaBox.SELECT_MANY_OPTION_TEMPLATE = '<option value=\"[[ primaryKey ]]\" >[[ Name ]]</option>';\n\n  QorMediaBox.plugin = function (options) {\n    return this.each(function () {\n      var $this = $(this);\n      var data = $this.data(NAMESPACE);\n      var fn;\n\n      if (!data) {\n        if (/destroy/.test(options)) {\n          return;\n        }\n\n        $this.data(NAMESPACE, (data = new QorMediaBox(this, options)));\n      }\n\n      if (typeof options === 'string' && $.isFunction(fn = data[options])) {\n        fn.apply(data);\n      }\n    });\n  };\n\n  $(function () {\n    var selector = '[data-toggle=\"qor.mediabox\"]';\n    $(document).\n      on(EVENT_DISABLE, function (e) {\n        QorMediaBox.plugin.call($(selector, e.target), 'destroy');\n      }).\n      on(EVENT_ENABLE, function (e) {\n        QorMediaBox.plugin.call($(selector, e.target));\n      }).\n      triggerHandler(EVENT_ENABLE);\n  });\n\n  return QorMediaBox;\n\n});\n"],"sourceRoot":"/source/"}